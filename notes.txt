--------------------------------------------
Android VS Linux
--------------------------------------------
C Library: 
- Android uses the Bionic C library, which is more memory-efficient and CPU-friendly than c libraries used by linux
- Linux uses the glibc and musl librarie

Scheduling Mechanisms: 
- Both systems use the Completely Fair Scheduler (CFS), which can lead to process starvation due to its non-real-time nature.

Memory Management: Android's Low Memory Killer automatically terminates low-priority applications to manage limited resources effectively.

Power Management: The 'suspend to RAM' feature allows Android to enter a low-power state while maintaining the state of running processes, which is more utilized than in traditional Linux.

Wakelocks: These are crucial in Android to keep the system awake while essential tasks are processed.

Inter-Process Communication (IPC): 
- Android uses the Binder IPC system (Kernel driver) for efficient communication between applications
- Linux uses the System V IPC for communication between applications

Hardware Abstraction Layer (HAL): HAL manages hardware resource access, preventing conflicts between applications.

Logging Mechanisms: 
- kernel logs: dmesg in both android and linux
- service logs: jounalctl in linux
                logcat in android     (data is handled through a circular buffer)

--------------------------------------------
flashing certain partition using adb
--------------------------------------------
adb reboot bootloader
fastboot reboot fastboot
fastboot flash system system.img

---------------------------------------------------------
remount the File System to be able to push or pull files
---------------------------------------------------------
adb root
adb shell mount -o rw,remount /
adb push arafa.txt /system/
adb push SensorTaskTestApp.apk /system/priv-app/SensorTaskTestApp/
adb push MathClientTestApp.apk /system/priv-app/MathClientTestApp/
adb push CarSpeedDemo.apk /system/priv-app/CarSpeedDemo/

-----------------------------------------------------------------
installing binary or library in specific partition (Android.bp)
-----------------------------------------------------------------
vendor: false              --> vendor partition
product_specific: false    --> product partition
device_specific: false     --> odm partition
system_ext_specific: false --> system_ext partition
if we donot choose any partition, it will be installed in system partition

--------------------------------------------
m, mm, mmm commands
--------------------------------------------
m <module_name>                             : build certain module whatever the current location
mm                                          : build the module at the current location
mmm <path_of_module_relative_to_aosp_root>  : build the module at the given relative path 

--------------------------------------------
commands
--------------------------------------------
service list
service call math 2 i32 6 i32 7       (2 is add function)
logcat | grep temperature
dmesg                                 (kernel logs / drivers messages)
logcat                                (services logs)
reboot
adb shell <command>
adb install -r CarSpeedDemo.apk
su
getenforce
setenforce 0
setenforce 1
adb pull /sys/fs/selinux/policy
adb logcat -b events -d | audit2allow -p policy

--------------------------------------------
Some Of Services
--------------------------------------------
// added during tasks
123     example.service.api.IExampleService/default: [example.service.api.IExampleService]
10      android.app.sensortask.ITemperatureService/default: [android.app.sensortask.ITemperatureService]
159     math: [android.app.math.IMathServiceManager]
228     sensor_task: [android.app.sensortask.ISensorTaskService]

// VHAL service in c++
26      android.hardware.automotive.vehicle.IVehicle/default: [android.hardware.automotive.vehicle.IVehicle]

// wrapper over VHAL service in java
89      car_service: [android.car.ICar]

// most used 
7       adb: [android.debug.IAdbManager]
156     logcat: [android.os.logcat.ILogcatManagerService]
178     mount: [android.os.storage.IStorageManager]

// important services that we always used in any android device
270     usb: [android.hardware.usb.IUsbManager]
281     wifi: [android.net.wifi.IWifiManager]
113     display: [android.hardware.display.IDisplayManager]
145     ipsec: [android.net.IIpSecService]
231     servicediscovery: [android.net.nsd.INsdManager]
232     settings: []
220     scheduling_policy: [android.os.ISchedulingPolicyService]
222     search: [android.app.ISearchManager]
261     time_detector: [android.app.timedetector.ITimeDetectorService]
238     speech_recognition: [android.speech.IRecognitionServiceManager]
205     power: [android.os.IPowerManager]
206     powerstats: [android.os.IPowerStatsService]
207     processinfo: [android.os.IProcessInfoService]
208     procstats: [com.android.internal.app.procstats.IProcessStats]
153     location: [android.location.ILocationManager]
75      audio: [android.media.IAudioService]
262     time_zone_detector: [android.app.timezonedetector.ITimeZoneDetectorService]
230     serial: [android.hardware.ISerialManager]
149     launcherapps: [android.content.pm.ILauncherApps]
27      android.hardware.bluetooth.IBluetoothHci/default: [android.hardware.bluetooth.IBluetoothHci]
28      android.hardware.bluetooth.audio.IBluetoothAudioProviderFactory/default: [android.hardware.bluetooth.audio.IBluetoothAudioProviderFactory]
29      android.hardware.broadcastradio.IBroadcastRadio/amfm: [android.hardware.broadcastradio.IBroadcastRadio]
30      android.hardware.broadcastradio.IBroadcastRadio/dab: [android.hardware.broadcastradio.IBroadcastRadio]
31      android.hardware.camera.provider.ICameraProvider/external/0: [android.hardware.camera.provider.ICameraProvider]
32      android.hardware.camera.provider.ICameraProvider/libcamera/0: [android.hardware.camera.provider.ICameraProvider]
23      android.hardware.automotive.can.ICanController/default: [android.hardware.automotive.can.ICanController]
12      android.automotive.watchdog.ICarWatchdog/default: [android.automotive.watchdog.ICarWatchdog]
13      android.automotive.watchdog.internal.ICarWatchdog/default: [android.automotive.watchdog.internal.ICarWatchdog]
9       alarm: [android.app.IAlarmManager]
4       account: [android.accounts.IAccountManager]
5       activity: [android.app.IActivityManager]
6       activity_task: [android.app.IActivityTaskManager]
42      android.hardware.power.IPower/default: [android.hardware.power.IPower]
52      android.hardware.usb.IUsb/default: [android.hardware.usb.IUsb]
51      android.hardware.tv.hdmi.connection.IHdmiConnection/default: [android.hardware.tv.hdmi.connection.IHdmiConnection]
49      android.hardware.thermal.IThermal/default: [android.hardware.thermal.IThermal]
54      android.hardware.wifi.IWifi/default: [android.hardware.wifi.IWifi]
77      autofill: [android.view.autofill.IAutoFillManager]
79      battery: []
80      batteryproperties: [android.os.IBatteryPropertiesRegistrar]
81      batterystats: [com.android.internal.app.IBatteryStats]
82      binder_calls_stats: []
85      bluetooth_manager: [android.bluetooth.IBluetoothManager]
86      broadcastradio: [android.hardware.radio.IRadioService]
101     cpuinfo: []
100     cpu_monitor: []
131     gpu: [android.graphicsenv.IGpuService]
133     graphicsstats: [android.view.IGraphicsStats]
135     hdmi_control: [android.hardware.hdmi.IHdmiControlService]
140     input: [android.hardware.input.IInputManager]
186     network_stack: [android.net.INetworkStackConnector]
183     netstats: [android.net.INetworkStatsService]
189     notification: [android.app.INotificationManager]
199     permission_checker: [android.permission.IPermissionChecker]
201     phone: [com.android.internal.telephony.ITelephony]
284     window: [android.view.IWindowManager]
126     file_integrity: [android.security.IFileIntegrityService]
87      bugreport: [android.os.IDumpstate]
88      cacheinfo: []
71      app_integrity: [android.content.integrity.IAppIntegrityManager]
72      app_search: [android.app.appsearch.aidl.IAppSearchManager]
21      android.frameworks.vibrator.IVibratorControlService/default: [android.frameworks.vibrator.IVibratorControlService]
92      color_display: [android.hardware.display.IColorDisplayManager]
151     lights: [android.hardware.lights.ILightsManager]
39      android.hardware.light.ILights/default: [android.hardware.light.ILights]
192     overlay: [android.content.om.IOverlayManager]
253     telecom: [com.android.internal.telecom.ITelecomService]
271     user: [android.os.IUserManager]
276     voiceinteraction: [com.android.internal.app.IVoiceInteractionManagerService]
273     vibrator_manager: [android.os.IVibratorManagerService]
274     virtualdevice: [android.companion.virtual.IVirtualDeviceManager]
278     vpn_management: [android.net.IVpnManager]
194     package: [android.content.pm.IPackageManager]
184     network_management: [android.os.INetworkManagementService]
111     devicestoragemonitor: []
112     diskstats: []
122     ethernet: [android.net.IEthernetManager]
22      android.hardware.automotive.audiocontrol.IAudioControl/default: [android.hardware.automotive.audiocontrol.IAudioControl]
16      android.frameworks.cameraservice.service.ICameraService/default: [android.frameworks.cameraservice.service.ICameraService]
33      android.hardware.cas.IMediaCasService/default: [android.hardware.cas.IMediaCasService]
36      android.hardware.graphics.allocator.IAllocator/default: [android.hardware.graphics.allocator.IAllocator]
37      android.hardware.graphics.composer3.IComposer/default: [android.hardware.graphics.composer3.IComposer]
38      android.hardware.health.IHealth/default: [android.hardware.health.IHealth]
56      android.security.authorization: [android.security.authorization.IKeystoreAuthorization]
68      app_binding: []
76      auth: [android.hardware.biometrics.IAuthService]
95      connectivity: [android.net.IConnectivityManager]
98      content: [android.content.IContentService]
99      country_detector: [android.location.ICountryDetector]
128     game: [android.app.IGameManagerService]
154     location_time_zone_manager: []
175     meminfo: []
180     netd: [android.net.INetd]
200     permissionmgr: [android.permission.IPermissionManager]
212     recovery: [android.os.IRecoverySystem]
213     remote_provisioning: [android.security.rkp.IRemoteProvisioning]
214     resources: [android.content.res.IResourcesManager]
235     slice: [android.app.slice.ISliceManager]
244     storaged: [android.os.IStoraged]

--------------------------------------------
VHAL Basics
--------------------------------------------
Property : any information that displayed by the car
	- car speed  (VEHICLE_SPEED)
    - engine rpm (ENGINE_RPM)
	- status of driver door
	- status of passenger door beside the driver
	- status of passenger behind the driver 
	- ..
	- water level
	- oil level
	- tier pressure
	- ...
	- INFO_VIN
    - hvac temperature (HVAC_TEMPERATURE_SET)
	
Each property has: 
- id
- access level: read / write / read-write
- areaIds
- change mode : static / on change / continuous
- value : int32 / float / ... 
- initial value
- getter handling
- setter handling
- status : available / not supported

VHAL : vehicle hardware abstraction layer (C++ layer)
- this layer 
   - is the HAL layer in Android Automotive 
   - abstracts vehicle hardware (CAN, ECUs, sensors, actuators) and shows them to Android as standardized “vehicle properties”.

VHAL interface : vehicle hardware abstraction layer interface
- this aidl interface 
   - is the aidl interface for a native service called android.hardware.automotive.vehicle.IVehicle/default
   - lives in hardware/interfaces/automotive/vehicle/aidl/android/hardware/automotive/vehicle/IVehicle.aidl
   - defines and maintain the properties that OEMs can implement
   - defines functions that we can use to get or set or subscribe to properties asynchronously
   
--------------------------------------------
how to calculate properity id
---------------------------------------------
ID = 0x0207 | 0x10000000 | 0x00600000 | 0x01000000
ID = 0x0308 | 0x10000000 | 0x00200000 | 0x01000000

<AOSP-ROOT>/hardware/interfaces/automotive/vehicle/2.0/types.hal
    enum VehiclePropertyType : int32_t {
        STRING          = 0x00100000,
        BOOLEAN         = 0x00200000,
        INT32           = 0x00400000,
        INT32_VEC       = 0x00410000,
        INT64           = 0x00500000,
        INT64_VEC       = 0x00510000,
        FLOAT           = 0x00600000,
        FLOAT_VEC       = 0x00610000,
        BYTES           = 0x00700000,
        MIXED           = 0x00e00000,
        MASK            = 0x00ff0000
    };
    
    enum VehicleArea : int32_t {
        GLOBAL      = 0x01000000,
        WINDOW      = 0x03000000,
        MIRROR      = 0x04000000,
        SEAT        = 0x05000000,
        DOOR        = 0x06000000,
        WHEEL       = 0x07000000,
        MASK        = 0x0f000000,
    };
    
    enum VehiclePropertyGroup : int32_t {
        SYSTEM      = 0x10000000,
        VENDOR      = 0x20000000,
        MASK        = 0xf0000000,
    };
    
    /**
     * Speed of the vehicle
     *
     * @change_mode VehiclePropertyChangeMode:CONTINUOUS
     * @access VehiclePropertyAccess:READ
     * @unit VehicleUnit:METER_PER_SEC
     */
    PERF_VEHICLE_SPEED = (
        0x0207
        | VehiclePropertyGroup:SYSTEM
        | VehiclePropertyType:FLOAT
        | VehicleArea:GLOBAL),

   /**
     * Fuel door open
     *
     * @change_mode VehiclePropertyChangeMode:ON_CHANGE
     * @access VehiclePropertyAccess:READ_WRITE
     */
    FUEL_DOOR_OPEN = (
        0x0308
        | VehiclePropertyGroup:SYSTEM
        | VehiclePropertyType:BOOLEAN
        | VehicleArea:GLOBAL),

--------------------------------------------
set and read a properity from terminal
--------------------------------------------
way 1 : 
    dumpsys android.hardware.automotive.vehicle.IVehicle/default --get 0x11600207
    dumpsys android.hardware.automotive.vehicle.IVehicle/default --set 0x11600207 -f 100.0
way 2 : used for properties that have READ_WRITE ACCESS ONLY 
    cmd car_service set-property-value 0x11200308 0 TRUE
    cmd car_service get-property-value 0x11200308

--------------------------------------------------------------
list all properties from terminal and their ID, and area ID
--------------------------------------------------------------
dumpsys android.hardware.automotive.vehicle.IVehicle/default --list

--------------------------------------------
Aidl files supported by AOSP
--------------------------------------------
aosp16-ras/hardware/interfaces/automotive/vehicle/aidl/android/hardware/automotive/vehicle$ ls

GetValueRequest.aidl        IVehicle.aidl                     RawPropValues.aidl     StatusCode.aidl                  VehiclePropConfig.aidl      VehiclePropertyChangeMode.aidl
GetValueRequests.aidl       IVehicleCallback.aidl             SetValueRequest.aidl   SubscribeOptions.aidl            VehiclePropConfigs.aidl     VehiclePropertyStatus.aidl
GetValueResult.aidl         MinMaxSupportedValueResult.aidl   SetValueRequests.aidl  SupportedValuesListResult.aidl   VehiclePropError.aidl       VehiclePropValue.aidl
GetValueResults.aidl        MinMaxSupportedValueResults.aidl  SetValueResult.aidl    SupportedValuesListResults.aidl  VehiclePropErrors.aidl      VehiclePropValues.aidl
HasSupportedValueInfo.aidl  PropIdAreaId.aidl                 SetValueResults.aidl   VehicleAreaConfig.aidl           VehiclePropertyAccess.aidl

--------------------------------------------
The VHAL functions
--------------------------------------------
- VHAL functions are defined at IVehicle.aidl
- VHAL is asynchronous. Results are returned via callbacks, not directly.

-----------------------------
Content of IVehicle.aidl
-----------------------------
package android.hardware.automotive.vehicle;

// Vehicle HAL interface.
@VintfStability
interface IVehicle {
    /**
     * Returns a list of all property configurations supported by this vehicle HAL.
     */
    VehiclePropConfigs getAllPropConfigs();

    /**
     * Returns a list of property configurations for given properties.
     */
    VehiclePropConfigs getPropConfigs(in int[] props);

    /**
     * Get vehicle property values asynchronously.
     */
    void getValues(IVehicleCallback callback, in GetValueRequests requests);

    /**
     * Set vehicle property values.
     */
    void setValues(IVehicleCallback callback, in SetValueRequests requests);

    /**
     * Subscribes to property events.
     */
    void subscribe(in IVehicleCallback callback, in SubscribeOptions[] options, int maxSharedMemoryFileCount);

    /**
     * Unsubscribes from property events.
     */
    void unsubscribe(in IVehicleCallback callback, in int[] propIds);

    /**
     * Return a shared memory file back to VHAL for recycle.
     */
    void returnSharedMemory(in IVehicleCallback callback, long sharedMemoryId);

    /**
     * Gets the supported values lists for [propId, areaId]s.
     */
    SupportedValuesListResults getSupportedValuesLists(in List<PropIdAreaId> propIdAreaIds);

    /**
     * Gets the min/max supported values for [propId, areaId]s.
     */
    MinMaxSupportedValueResults getMinMaxSupportedValue(in List<PropIdAreaId> propIdAreaIds);

    /**
     * Registers the supported value change callback.
     */
    void registerSupportedValueChangeCallback(in IVehicleCallback callback, in List<PropIdAreaId> propIdAreaIds);

    /**
     * Unregisters the supported value change callback.
     */
    void unregisterSupportedValueChangeCallback(in IVehicleCallback callback, in List<PropIdAreaId> propIdAreaIds);
}

---------------------------------
Content of IVehicleCallback.aidl
---------------------------------
package android.hardware.automotive.vehicle;

@VintfStability
interface IVehicleCallback {
    /**
     * Callback for {@link IVehicle#getValues} function.
     */
    oneway void onGetValues(in GetValueResults responses);

    /**
     * Callback for {@link IVehicle#setValues} function.
     */
    oneway void onSetValues(in SetValueResults responses);

    /**
     * Event callback happens whenever one or more variables that the API user
     * has subscribed to need to be reported. This may be based purely on
     * threshold and frequency (a regular subscription, see subscribe call's
     * arguments) or when the {@link IVehicle#setValues} method was called and
     * the actual change needs to be reported.
     */
    oneway void onPropertyEvent(in VehiclePropValues propValues, int sharedMemoryFileCount);

    /**
     * Set property value is usually asynchronous operation. Thus even if
     * client received {@link StatusCode#OK} from {@link IVehicle#setValues}, or
     * received {@link StatusCode#OK} in {@link #onSetValues}, this doesn't
     * guarantee that the value was successfully propagated to the vehicle
     * network. If such rare event occurs this method must be called.
     */
    oneway void onPropertySetError(in VehiclePropErrors errors);

    /**
     * Called when the min/max supported value or supported value list for
     * the registered [propId, areaId]s changes.
     */
    oneway void onSupportedValueChange(in List<PropIdAreaId> propIdAreaIds);
}
